/*

Стартова сторінка

*/

namespace StorageAndTrade;

using Gtk;
using InterfaceGtk4;

using GeneratedCode.Довідники;
using GeneratedCode.Перелічення;

partial class Номенклатура_Елемент : DirectoryFormElement
{
    public Номенклатура_Objest Елемент { get; } = new Номенклатура_Objest();

    #region Fields

    Entry Код = new() { WidthRequest = 100 };
    public Entry Назва { get; private set; } = new() { WidthRequest = 500 };
    TextView НазваПовна = new();
    TextView Опис = new();
    ComboBoxText ТипНоменклатури = new();
    Entry Артикул = new() { WidthRequest = 500 };

    #endregion

    public Номенклатура_Елемент() : base(Program.BasicForm?.NotebookFunc)
    {
        Element = Елемент;
    }

    protected override void CreateStart(Box vBox)
    {
        //Код
        CreateField(vBox, "Код:", Код);

        //Назва
        CreateField(vBox, "Назва:", Назва);

        //НазваПовна
        CreateFieldView(vBox, "Повна назва:", НазваПовна, 500, 60);

        //Артикул
        CreateField(vBox, "Артикул:", Артикул);

        //Тип
        foreach (var field in ПсевдонімиПерелічення.ТипиНоменклатури_List())
            ТипНоменклатури.Append(field.Value.ToString(), field.Name);

        CreateField(vBox, "Тип:", ТипНоменклатури);

        //Опис
        CreateFieldView(vBox, "Опис:", Опис, 500, 200);
    }

    protected override void CreateEnd(Box vBox)
    {

    }

    #region Присвоєння / зчитування значень

    public override async ValueTask AssignValue()
    {
        if (IsNew)
        {
            Елемент.ТипНоменклатури = ТипиНоменклатури.Товар;
        }

        Код.SetText(Елемент.Код);
        Назва.SetText(Елемент.Назва);
        Артикул.SetText(Елемент.Артикул);
        ТипНоменклатури.ActiveId = Елемент.ТипНоменклатури.ToString();
        Опис.Buffer?.Text = Елемент.Опис;

        if (ТипНоменклатури.Active == -1) ТипНоменклатури.ActiveId = ТипиНоменклатури.Товар.ToString();
    }

    protected override void GetValue()
    {
        Елемент.Код = Код.GetText();
        Елемент.Назва = Назва.GetText();
        Елемент.Артикул = Артикул.GetText();
        Елемент.ТипНоменклатури = Enum.TryParse(ТипНоменклатури.ActiveId, out ТипиНоменклатури value) ? value : 0;
        Елемент.Опис = Опис.Buffer?.Text ?? "";
    }

    #endregion

    protected override async ValueTask<bool> Save()
    {
        try
        {
            if (await Елемент.Save())
            {

            }

            return true;
        }
        catch /*(Exception ex)*/
        {

            return false;
        }
    }
}
